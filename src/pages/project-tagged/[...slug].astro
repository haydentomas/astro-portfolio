---
import { getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';
import Icon from '../../components/Icon.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('projectstagged');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, 
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const allPosts = (await getCollection('projectstagged'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const findCurrentPostIndex = (slug: string) => {
  return allPosts.findIndex(post => post.slug === slug);
};

// Extract the current slug more reliably
const currentSlug = Astro.params.slug;

// Find current post and neighboring posts (with error handling)
const currentIndex = findCurrentPostIndex(currentSlug);
const previousPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
const nextPost = currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
---




<PostLayout frontmatter={entry.data}>
  {/* ... (your other content) ... */}

  <div class="w-auto mx-auto text-center mt-8"> 
    {/* Only show Previous if it's NOT the first post */}
    {currentIndex > 0 && previousPost && (
      <a href={`/project-tagged/${previousPost.slug}`} class="text-blue-500 hover:text-blue-700 block text-left"> ⬅️ Previous: {previousPost.data.title}</a>
    )}

    {/* Only show Next if it's NOT the last post */}
    {currentIndex < allPosts.length - 1 && nextPost && (
      <a href={`/project-tagged/${nextPost.slug}`} class="text-blue-500 hover:text-blue-700 block text-right"> Next: {nextPost.data.title} ➡️</a>
    )}
  </div>

</PostLayout>