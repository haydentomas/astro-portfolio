---

import MainLayout from '../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import { Picture } from 'astro:assets';
const allPosts = await getCollection("posts");
const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

const title = 'Hayden Tomas - Website Developer';
const description = 'A UK Based front-end developer who focuses on building fast, secure websites that are accessible to all.';
const Name = 'Hayden Tomas - Website Developer';
const image = '/images/your-og-image.jpg'; // Relative path to your OG image

// Define a type for the individual post item (adjusted)
type PostItem = {
    data: {
        title: string;
        description: string;
        image: any; // Use a generic type for the image property
        imageAlt: string;
        pubDate?: string; // Make pubDate optional
    };
    slug: string;
};

// Fetch the latest 3 posts (replace 'posts' with your actual collection name if different)
const posts = await getCollection('posts', ({ data }) => data.draft !== true);
posts.sort((a, b) => {
    const dateA = a.data.pubDate ? new Date(a.data.pubDate) : new Date(0);
    const dateB = b.data.pubDate ? new Date(b.data.pubDate) : new Date(0);
    return dateB.getTime() - dateA.getTime();
});
const latestPosts = posts.slice(0, 3) as unknown as PostItem[]; // Type assertion
---
<MainLayout title={title} description={description} image={image}>
    <main class="container">
        <h1>{Name}</h1>
        <p>
            I'm a UK based front-end developer who focuses on building fast, secure websites that are accessible to all.
        </p>

        <div class="">
            {latestPosts.map(({ data, slug }) => ( 
                <a href={`/posts/${slug}`} class="block text-black no-underline">
                    <div class="">
                        <h3 class="">{data.title}</h3>
                        {data.pubDate && ( /* Conditionally display pubDate if it exists */
                            <p class="pub-date">Published: {new Date(data.pubDate).toLocaleDateString()}</p>
                        )}
                        <p>{data.description}</p>
                        <div class="">
                            <Picture formats={['avif', 'webp']} src={data.image} alt={data.imageAlt} height="200" width="300" class="m-auto"/>
                        </div>
                    </div>
                </a>
            ))}
        </div>

        <h2>latest Projects</h2>
    </main>
</MainLayout>